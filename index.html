<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypto Wallet</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #18222d);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-hint: var(--tg-theme-hint-color, #707579);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #232e3c);
            --green: #27ae60;
            --red: #c0392b;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 15px; margin: 0; background-color: var(--tg-bg); color: var(--tg-text);
        }
        .actions-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px; text-align: center; }
        .action-button { display: flex; flex-direction: column; align-items: center; font-size: 14px; cursor: pointer; }
        .action-icon { width: 48px; height: 48px; background-color: var(--tg-secondary-bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 5px; }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω–∞ */
        #main-view .wallet-header { text-align: center; margin-bottom: 25px; }
        #main-view .balance-total { font-size: 36px; font-weight: 600; }
        #main-view .balance-hint { color: var(--tg-hint); font-size: 14px; }
        #main-view .asset-list-title { font-weight: 600; margin-bottom: 10px; }
        #main-view .asset-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--tg-secondary-bg); cursor: pointer; }
        #main-view .asset-item:last-child { border-bottom: none; }
        #main-view .asset-icon { width: 40px; height: 40px; margin-right: 12px; }
        #main-view .asset-info { flex-grow: 1; }
        #main-view .asset-name { font-weight: 500; }
        #main-view .asset-balance-crypto { color: var(--tg-hint); font-size: 14px; }
        #main-view .asset-value { text-align: right; }
        #main-view .asset-balance-usd { font-weight: 500; }
        #main-view .asset-price-change { font-size: 14px; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –µ–∫—Ä–∞–Ω–∞ –¥–µ—Ç–∞–ª–µ–π */
        #detail-view .detail-header { display: flex; align-items: center; margin-bottom: 20px; }
        #detail-view .back-button { font-size: 24px; cursor: pointer; margin-right: 15px; padding: 5px; }
        #detail-view .asset-title-icon { width: 32px; height: 32px; margin-right: 10px; }
        #detail-view .asset-title-name { font-size: 20px; font-weight: 600; }
        #detail-view .balance-total { font-size: 32px; font-weight: 500; text-align: center; }
        #detail-view .balance-crypto { color: var(--tg-hint); font-size: 16px; text-align: center; margin-bottom: 20px; }
        #chart-container { width: 100%; height: 250px; margin-bottom: 20px; }

        .positive { color: var(--green); }
        .negative { color: var(--red); }
    </style>
</head>
<body>
    <div id="main-view">
        <div class="wallet-header">
            <div id="total-balance-usd" class="balance-total">$0.00</div>
            <div class="balance-hint">–ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å –≤ USD</div>
        </div>
        <div class="actions-bar">
            <div class="action-button" onclick="showAlert('–ü–æ–ø–æ–≤–Ω–∏—Ç–∏')"><div class="action-icon">‚ûï</div><span>–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–í–∏–≤–µ—Å—Ç–∏')"><div class="action-icon">‚¨ÜÔ∏è</div><span>–í–∏–≤–µ—Å—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–û–±–º—ñ–Ω—è—Ç–∏')"><div class="action-icon">üîÑ</div><span>–û–±–º—ñ–Ω—è—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–ë—ñ—Ä–∂–∞')"><div class="action-icon">üìà</div><span>–ë—ñ—Ä–∂–∞</span></div>
        </div>
        <div class="asset-list-title">–ê–∫—Ç–∏–≤–∏</div>
        <div id="asset-list"></div>
    </div>

    <div id="detail-view" style="display: none;">
        <div class="detail-header">
            <div class="back-button" onclick="showMainView()">‚Üê</div>
            <img id="detail-asset-icon" src="" class="asset-title-icon">
            <div id="detail-asset-name" class="asset-title-name"></div>
        </div>
        <div id="detail-balance-usd" class="balance-total"></div>
        <div id="detail-balance-crypto" class="balance-crypto"></div>
        <div id="chart-container"></div>
        <div class="actions-bar">
             <div class="action-button" onclick="showAlert('–ü–æ–ø–æ–≤–Ω–∏—Ç–∏')"><div class="action-icon">‚ûï</div><span>–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–í–∏–≤–µ—Å—Ç–∏')"><div class="action-icon">‚¨ÜÔ∏è</div><span>–í–∏–≤–µ—Å—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–û–±–º—ñ–Ω—è—Ç–∏')"><div class="action-icon">üîÑ</div><span>–û–±–º—ñ–Ω—è—Ç–∏</span></div>
            <div class="action-button" onclick="showAlert('–ë—ñ—Ä–∂–∞')"><div class="action-icon">üìà</div><span>–ë—ñ—Ä–∂–∞</span></div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const mainView = document.getElementById('main-view');
        const detailView = document.getElementById('detail-view');
        let chart = null;

        function showAlert(action) {
            tg.showAlert(`–§—É–Ω–∫—Ü—ñ—è "${action}" –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ.`);
        }

        const myAssets = [
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', balance: 0.05, iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/1027.png' },
            { id: 'tether', symbol: 'USDT', name: 'Tether', balance: 100.50, iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/825.png' },
            { id: 'the-open-network', symbol: 'TON', name: 'Toncoin', balance: 25.0, iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/11419.png' }
        ];

        function showMainView() {
            mainView.style.display = 'block';
            detailView.style.display = 'none';
        }

        async function showDetailView(asset, priceData) {
            mainView.style.display = 'none';
            detailView.style.display = 'block';

            document.getElementById('detail-asset-icon').src = asset.iconUrl;
            document.getElementById('detail-asset-name').textContent = asset.name;
            const usdValue = asset.balance * priceData.usd;
            document.getElementById('detail-balance-usd').textContent = `$${usdValue.toFixed(2)}`;
            document.getElementById('detail-balance-crypto').textContent = `${asset.balance.toFixed(4)} ${asset.symbol}`;
            
            await createChart(asset.id);
        }

        async function createChart(assetId) {
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = ''; 

            const historyUrl = `https://api.coingecko.com/api/v3/coins/${assetId}/market_chart?vs_currency=usd&days=30`;
            const response = await fetch(historyUrl);
            const data = await response.json();
            const chartData = data.prices.map(p => ({ time: p[0] / 1000, value: p[1] }));

            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: chartContainer.clientHeight,
                layout: { backgroundColor: 'transparent', textColor: 'var(--tg-text)' },
                grid: { vertLines: { color: 'var(--tg-secondary-bg)' }, horzLines: { color: 'var(--tg-secondary-bg)' } },
                crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
                rightPriceScale: { borderColor: 'var(--tg-hint)' },
                timeScale: { borderColor: 'var(--tg-hint)' }
            });

            const lineSeries = chart.addLineSeries({ color: '#5a88c8', lineWidth: 2 });
            lineSeries.setData(chartData);
            chart.timeScale().fitContent();
        }

        async function displayAssets() {
            const pricesUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${myAssets.map(a=>a.id).join(',')}&vs_currencies=usd&include_24hr_change=true`;
            const response = await fetch(pricesUrl);
            const prices = await response.json();
            
            const assetListElement = document.getElementById('asset-list');
            let totalUsdValue = 0;
            let html = '';

            for (const asset of myAssets) {
                const priceData = prices[asset.id];
                if (!priceData) continue;
                
                const usdValue = asset.balance * priceData.usd;
                const priceChange = priceData.usd_24h_change || 0;
                totalUsdValue += usdValue;

                const changeClass = priceChange >= 0 ? 'positive' : 'negative';
                const changeSign = priceChange >= 0 ? '+' : '';

                html += `
                    <div class="asset-item" onclick='showDetailView(${JSON.stringify(asset)}, ${JSON.stringify(priceData)})'>
                        <img src="${asset.iconUrl}" class="asset-icon" alt="${asset.name}">
                        <div class="asset-info">
                            <div class="asset-name">${asset.name}</div>
                            <div class="asset-balance-crypto">${asset.balance.toFixed(4)} ${asset.symbol.toUpperCase()}</div>
                        </div>
                        <div class="asset-value">
                            <div class="asset-balance-usd">$${usdValue.toFixed(2)}</div>
                            <div class="asset-price-change ${changeClass}">
                                ${changeSign}${priceChange.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                `;
            }
            assetListElement.innerHTML = html;
            document.getElementById('total-balance-usd').textContent = `$${totalUsdValue.toFixed(2)}`;
        }

        window.addEventListener('load', displayAssets);
    </script>
</body>
</html>