<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypto Wallet</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f3f3f3);
            --green: #27ae60;
            --red: #c0392b;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 15px;
            margin: 0;
            background-color: var(--tg-bg);
            color: var(--tg-text);
        }
        .wallet-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .balance-total {
            font-size: 36px;
            font-weight: 600;
        }
        .balance-hint {
            color: var(--tg-hint);
            font-size: 14px;
        }
        .actions-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
        }
        .action-icon {
            width: 48px;
            height: 48px;
            background-color: var(--tg-secondary-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 5px;
        }
        .asset-list-title {
            font-weight: 600;
            margin-bottom: 10px;
        }
        .asset-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--tg-secondary-bg);
        }
        .asset-item:last-child {
            border-bottom: none;
        }
        .asset-icon {
            width: 40px;
            height: 40px;
            margin-right: 12px;
        }
        .asset-info {
            flex-grow: 1;
        }
        .asset-name {
            font-weight: 500;
        }
        .asset-balance-crypto {
            color: var(--tg-hint);
            font-size: 14px;
        }
        .asset-value {
            text-align: right;
        }
        .asset-balance-usd {
            font-weight: 500;
        }
        .asset-price-change {
            font-size: 14px;
        }
        .positive { color: var(--green); }
        .negative { color: var(--red); }
    </style>
</head>
<body>

    <div class="wallet-header">
        <div id="total-balance-usd" class="balance-total">$0.00</div>
        <div class="balance-hint">–ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å –≤ USD</div>
    </div>

    <div class="actions-bar">
        <div class="action-button" onclick="showAlert('–ü–æ–ø–æ–≤–Ω–∏—Ç–∏')">
            <div class="action-icon">‚ûï</div>
            <span>–ü–æ–ø–æ–≤–Ω–∏—Ç–∏</span>
        </div>
        <div class="action-button" onclick="showAlert('–í–∏–≤–µ—Å—Ç–∏')">
            <div class="action-icon">‚¨ÜÔ∏è</div>
            <span>–í–∏–≤–µ—Å—Ç–∏</span>
        </div>
        <div class="action-button" onclick="showAlert('–û–±–º—ñ–Ω—è—Ç–∏')">
            <div class="action-icon">üîÑ</div>
            <span>–û–±–º—ñ–Ω—è—Ç–∏</span>
        </div>
        <div class="action-button" onclick="showAlert('–ë—ñ—Ä–∂–∞')">
            <div class="action-icon">üìà</div>
            <span>–ë—ñ—Ä–∂–∞</span>
        </div>
    </div>

    <div class="asset-list-title">–ê–∫—Ç–∏–≤–∏</div>
    <div id="asset-list">
        </div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        function showAlert(action) {
            tg.showAlert(`–§—É–Ω–∫—Ü—ñ—è "${action}" –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ.`);
        }

        // --- –î–ê–ù–Ü –¢–ê –õ–û–ì–Ü–ö–ê ---

        // 1. –û–ù–û–í–õ–ï–ù–û: –î–æ–¥–∞–Ω–æ –ø—Ä—è–º—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è 'iconUrl' –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∞–∫—Ç–∏–≤—É
        const myAssets = [
            { 
                id: 'ethereum', 
                symbol: 'ETH', 
                name: 'Ethereum', 
                balance: 0.05,
                iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/1027.png' 
            },
            { 
                id: 'tether', 
                symbol: 'USDT', 
                name: 'Tether', 
                balance: 100.50,
                iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/825.png'
            },
            { 
                id: 'the-open-network', 
                symbol: 'TON', 
                name: 'Toncoin', 
                balance: 25.0,
                iconUrl: 'https://s2.coinmarketcap.com/static/img/coins/64x64/11419.png'
            }
        ];

        // 2. –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ API CoinGecko
        async function fetchAssetPrices() {
            const assetIds = myAssets.map(asset => asset.id).join(',');
            const apiUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${assetIds}&vs_currencies=usd&include_24hr_change=true`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                console.error("Failed to fetch prices:", error);
                tg.showAlert("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫—É—Ä—Å–∏ –≤–∞–ª—é—Ç.");
                return null;
            }
        }

        // 3. –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤—ñ–≤
        async function displayAssets() {
            const prices = await fetchAssetPrices();
            if (!prices) return;

            const assetListElement = document.getElementById('asset-list');
            const totalBalanceElement = document.getElementById('total-balance-usd');
            let totalUsdValue = 0;
            let html = '';

            for (const asset of myAssets) {
                const priceData = prices[asset.id];
                if (!priceData) continue;

                const usdPrice = priceData.usd;
                const usdValue = asset.balance * usdPrice;
                const priceChange = priceData.usd_24h_change || 0;
                totalUsdValue += usdValue;

                const changeClass = priceChange >= 0 ? 'positive' : 'negative';
                const changeSign = priceChange >= 0 ? '+' : '';

                // –û–ù–û–í–õ–ï–ù–û: –¢–µ–≥ <img> —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ asset.iconUrl
                html += `
                    <div class="asset-item">
                        <img src="${asset.iconUrl}" class="asset-icon" alt="${asset.name}">
                        <div class="asset-info">
                            <div class="asset-name">${asset.name}</div>
                            <div class="asset-balance-crypto">${asset.balance.toFixed(4)} ${asset.symbol.toUpperCase()}</div>
                        </div>
                        <div class="asset-value">
                            <div class="asset-balance-usd">$${usdValue.toFixed(2)}</div>
                            <div class="asset-price-change ${changeClass}">
                                ${changeSign}${priceChange.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                `;
            }

            assetListElement.innerHTML = html;
            totalBalanceElement.textContent = `$${totalUsdValue.toFixed(2)}`;
        }

        // –í–ò–î–ê–õ–ï–ù–û: –°—Ç–∞—Ä–∞ –º–∞–ø–∞ assetIdsToImageMap –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞

        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', displayAssets);
    </script>
</body>
</html>